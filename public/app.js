"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var budgetCtrl=function(){var e=function(){function e(t,n,i){_classCallCheck(this,e),this.id=t,this.description=n,this.value=i,this.percentage=-1}return _createClass(e,[{key:"getPercent",value:function(){return this.percentage}},{key:"calcPercent",value:function(e){e>0&&(this.percentage=Math.round(this.value/e*100))}}]),e}(),t=function(e){var t=0;n.items[e].forEach(function(e){t+=e.value}),n.total[e]=t},n={items:{exp:[],inc:[]},total:{exp:0,inc:0},budget:0,percentage:-1};return{addItem:function(t,i,c){var a=void 0,r=0;return n.items[t].length>0&&(r=n.items[t][n.items[t].length-1].id+1),a="exp"===t?new e(r,i,c):new function e(t,n,i){_classCallCheck(this,e),this.id=t,this.description=n,this.value=i}(r,i,c),n.items[t].push(a),a},delItem:function(e,t){var i;-1!==(i=n.items[e].map(function(e){return console.log(e.id),e.id}).indexOf(t))&&n.items[e].splice(i,1)},getPercentages:function(){return n.items.exp.map(function(e){return e.getPercent()})},calculatePercentages:function(){n.items.exp.forEach(function(e){e.calcPercent(n.total.inc)})},calcBudget:function(){t("inc"),t("exp"),n.budget=n.total.inc-n.total.exp,n.total.inc>0?n.percentage=Math.round(n.total.exp/n.total.inc*100):n.percentage=-1},getBudget:function(){return{budget:n.budget,totalInc:n.total.inc,totalExp:n.total.exp,percentage:n.percentage}},testing:function(){console.log(n)}}}(),UICtrl=function(){var e={inputType:".js-add__type",inputDescription:".js-add__description",inputValue:".js-add__value",inputBtn:".js-add__btn",incomesContainer:".js-incomes__list",expensesContainer:".js-expenses__list",budgetLabel:".js-budget__value",incomesLabel:".js-budget__incomes--value",expensesLabel:".js-budget__expenses--value",percentageLabel:".js-budget__expenses--percentage",container:".js-container",expensesPercLabel:".js-item__percentage",dateLabel:".js-month"},t=function(e,t){var n,i,c=void 0;return c=(n=Math.abs(e).toFixed(2).split("."))[0],i=n[1],c.lenght>3&&(c=c.substr(0,c.lenght-3)+"."+c.substr(c.lenght-3,3)),("exp"===t?"-":"+")+" R$ "+c+","+i},n=function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)};return{getDOMstrings:function(){return e},getInput:function(){return{type:document.querySelector(e.inputType).value,description:document.querySelector(e.inputDescription).value,value:parseFloat(document.querySelector(e.inputValue).value)}},clearFields:function(){var t=document.querySelectorAll(e.inputDescription+", "+e.inputValue),n=Array.prototype.slice.call(t);n.forEach(function(e){e.value=""}),n[0].focus()},addListItem:function(n,i){var c=void 0,a=void 0,r=void 0;"inc"===i?(r=e.incomesContainer,c='<div class="item clearfix" id="inc-%id%"><div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div><div class="item__delete"><button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'):(r=e.expensesContainer,c='<div class="item clearfix" id="exp-%id%"><div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div><div class="item__percentage js-item__percentage">21%</div><div class="item__delete"><button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'),a=(a=(a=c.replace("%id%",n.id)).replace("%description%",n.description)).replace("%value%",t(n.value,i)),document.querySelector(r).insertAdjacentHTML("beforeend",a)},delListItem:function(e){var t=document.getElementById(e);t.parentNode.removeChild(t)},displayBudget:function(n){var i=void 0;i=n.budget>0?"inc":"exp",document.querySelector(e.budgetLabel).textContent=t(n.budget,i),document.querySelector(e.incomesLabel).textContent=t(n.totalInc,"inc"),document.querySelector(e.expensesLabel).textContent=t(n.totalExp,"exp"),n.percentage>0?document.querySelector(e.percentageLabel).textContent=n.percentage+"%":document.querySelector(e.percentageLabel).textContent="---"},displayPercentages:function(t){var i=document.querySelectorAll(e.expensesPercLabel);n(i,function(e,n){t[n]>0?e.textContent=t[n]+" %":e.textContent="---"})},changeType:function(){var t=document.querySelectorAll(e.inputType+",\n        "+e.inputDescription+",\n        "+e.inputValue);n(t,function(t){t.classList.toggle("red-focus"),document.querySelector(e.inputBtn).classList.toggle("red")})},displayMonth:function(){var t=new Date,n=t.getFullYear(),i=t.getMonth();document.querySelector(e.dateLabel).textContent=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][i]+" de "+n}}}(),mainCtrl=function(e,t){var n=function(){var n=t.getInput(),i=void 0;isNaN(n.value)||(""===n.description&&(n.description="No description"),i=e.addItem(n.type,n.description,n.value),t.addListItem(i,n.type),t.clearFields(),c(),"exp"===n.type&&a())},i=function(n){var i=n.target.parentNode.parentNode.parentNode,r=(i=i.id?i.id:i.parentNode.id).split("-"),o=r[0],l=parseInt(r[1]);e.delItem(o,l),t.delListItem(i),c(),a()},c=function(){e.calcBudget();var n=e.getBudget();t.displayBudget(n)},a=function(){e.calculatePercentages();var n=e.getPercentages();t.displayPercentages(n)};return{init:function(){var e;console.log("Application has started"),t.displayBudget({budget:0,totalInc:0,totalExp:0,percentage:-1}),e=t.getDOMstrings(),document.querySelector(e.inputBtn).addEventListener("click",n),document.addEventListener("keypress",function(e){13!==e.keycode&&13!==e.which||n()}),document.querySelector(e.container).addEventListener("click",i),document.querySelector(e.inputType).addEventListener("change",t.changeType),t.displayMonth()}}}(budgetCtrl,UICtrl);mainCtrl.init();